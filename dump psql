/*CREACION DE LA BASE DE DATOS Y SCRIPTS DE CREACION DE TODAS LAS TABLAS CON SUS RESPECTIVOS CONSTRAINT
CABE DESTACAR QUE SE ESTA UTILIZANDO UNA DB POSTGRESQL
TODAS LAS TABLAS Y CONSTRAINTS HAN SIDO PROBADAD CON LOS DIFERENTES INSERTS Y CON BUSQUEDAS
LA CREACION DE TABLAS HA SIDO SIGUIENDO EL MER DEFINITIVO
*/

CREATE DATABASE belakorGames OWNER alejandro;
GRANT ALL PRIVILEGES ON DATABASE belakorGames TO alejandro;

CREATE TABLE USUARIO (
    ID_USUARIO SERIAL NOT NULL,
    EMAIL VARCHAR(50) NOT NULL,
    PASSWORD VARCHAR(50) NOT NULL,
    NOMBRE VARCHAR(25) NOT NULL,
    APELLIDOS VARCHAR(50) NOT NULL,
    DIRECCION VARCHAR(250) NOT NULL,
    ADMIN BOOLEAN NOT NULL DEFAULT FALSE,

    CONSTRAINT pk_USUARIO PRIMARY KEY (ID_USUARIO)
    
)

INSERT INTO USUARIO VALUES (DEFAULT, 'alejandro@gmail.com', 'alejandro', 'alejandro', 'sanchez garcia', 'casa de alejandro', true );
INSERT INTO USUARIO VALUES (DEFAULT, 'MIGUEL@gmail.com', 'MIGUEL', 'MIGUEL', 'BACO', 'casa de miguel', false );



CREATE TABLE PEDIDO (
    ID_PEDIDO SERIAL NOT NULL,
    COMPRADO BOOLEAN NOT NULL DEFAULT FALSE,
    FECHA VARCHAR (10) NOT NULL,
    ID_USUARIO INT NOT NULL REFERENCES USUARIO,

    CONSTRAINT pk_PEDIDO PRIMARY KEY(ID_PEDIDO)
    
);
INSERT INTO PEDIDO VALUES(DEFAULT, TRUE, '20/04/2021', 1);
INSERT INTO PEDIDO VALUES(DEFAULT, TRUE, '20/04/2021', 2);

CREATE TABLE CATEGORIA (
    ID_CATEGORIA SERIAL NOT NULL,
    NOMBRE_CATEGORIA VARCHAR(20) NOT NULL,
    DESCRIPCION_CATEGORIA VARCHAR(250) NOT NULL,

    CONSTRAINT pk_CATEGORIA PRIMARY KEY (ID_CATEGORIA)
);
INSERT INTO CATEGORIA VALUES(DEFAULT, 'DEPORTES', 'JUEGOS DE DEPORTES');
INSERT INTO CATEGORIA VALUES(DEFAULT, 'SHOOTER', 'JUEGOS DE DISPAROS');


CREATE TABLE PRODUCTO (
    ID_PRODUCTO SERIAL NOT NULL,
    NOMBRE_PRODUCTO VARCHAR(25) NOT NULL,
    DESCRIPCION_PRODUCTO VARCHAR(250) NOT NULL,
    PRECIO NUMERIC(4,2) NOT NULL,
    STOCK NUMERIC(3,0) NOT NULL,
    IMAGEN VARCHAR(100) NOT NULL,
    ID_CATEGORIA INT NOT NULL REFERENCES CATEGORIA,

    CONSTRAINT pk_PRODUCTO PRIMARY KEY (ID_PRODUCTO)
);
INSERT INTO PRODUCTO VALUES(DEFAULT, 'FIFA 22', 'JUEGO DE FUTBOL', 45.5, 20, 'FIFA22.JPG', 1);
INSERT INTO PRODUCTO VALUES(DEFAULT, 'FORTNITE', 'JUEGO DE DISPAROS', 25.5, 30, 'FORTNITE.JPG', 2);

CREATE TABLE VALORACION (
    COMENTARIO VARCHAR(300) NOT NULL,
    PUNTUACION NUMERIC(1) NOT NULL,
    ID_USUARIO INT NOT NULL REFERENCES USUARIO,
    ID_PRODUCTO INT NOT NULL REFERENCES PRODUCTO,

    CONSTRAINT pk_VALORACION PRIMARY KEY(ID_USUARIO, ID_PRODUCTO)
);
INSERT INTO VALORACION VALUES('ESTE JUEGO NO ME GUSTA', 1, 2, 2);
INSERT INTO VALORACION VALUES('ES MUY REPETITIVO', 2, 1, 1);

CREATE TABLE LISTA_DESEOS (
    ID_USUARIO INT NOT NULL REFERENCES USUARIO,
    ID_PRODUCTO INT NOT NULL REFERENCES PRODUCTO,

    CONSTRAINT pk_LISTA_DESEOS PRIMARY KEY(ID_USUARIO, ID_PRODUCTO)
);
INSERT INTO LISTA_DESEOS VALUES(1, 1);
INSERT INTO LISTA_DESEOS VALUES(2, 2);

CREATE TABLE DETALLE_PEDIDO (
    ID_PEDIDO INT NOT NULL REFERENCES PEDIDO,
    ID_PRODUCTO INT NOT NULL REFERENCES PRODUCTO,
    CANTIDAD NUMERIC(2,0) NOT NULL,
    DEVUELTO BOOLEAN NOT NULL DEFAULT FALSE,

    CONSTRAINT pk_DETALLE_PEDIDO PRIMARY KEY(ID_PEDIDO, ID_PRODUCTO)
);
INSERT INTO DETALLE_PEDIDO VALUES(2, 1, 2, FALSE);
INSERT INTO DETALLE_PEDIDO VALUES(2, 2, 2, FALSE);